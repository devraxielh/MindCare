{% extends 'base.html' %}

{% block content %}
<h2>Encuesta de Salud Mental</h2>
<p>Por favor responde las siguientes preguntas con honestidad para obtener una recomendación personalizada.</p>

<form method="post" id="survey-form">
    {% csrf_token %}

    {% for field in form %}
    <div class="survey-step" id="step-{{ forloop.counter0 }}" style="display: none;">
        <div style="margin-bottom: 2rem;">
            <label for="{{ field.id_for_label }}"
                style="font-weight: 500; font-size: 1.2rem; display: block; margin-bottom: 1rem;">
                {{ field.label }}
            </label>
            {{ field }}
            {% if field.help_text %}
            <div
                style="background: #f0f7ff; border-left: 3px solid var(--primary-color); padding: 0.8rem 1rem; margin-top: 1rem; border-radius: 4px;">
                <span style="color: var(--primary-color); font-weight: bold; margin-right: 0.5rem;">ℹ️</span>
                <span style="color: #555; font-size: 0.95rem; line-height: 1.5;">{{ field.help_text }}</span>
            </div>
            {% endif %}
        </div>

        <div style="display: flex; justify-content: space-between;">
            {% if not forloop.first %}
            <button type="button" onclick="prevStep({{ forloop.counter0 }})"
                style="background-color: #ccc;">Anterior</button>
            {% else %}
            <div></div> <!-- Spacer -->
            {% endif %}

            {% if not forloop.last %}
            <button type="button" onclick="nextStep({{ forloop.counter0 }})">Siguiente</button>
            {% else %}
            <button type="submit">Obtener Recomendación</button>
            {% endif %}
        </div>

        <div style="margin-top: 2rem; text-align: center; color: #aaa; font-size: 0.9rem;">
            Pregunta {{ forloop.counter }} de {{ form.visible_fields|length }}
        </div>
    </div>
    {% endfor %}

</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        showStep(0);
    });

    function showStep(stepIndex) {
        // Hide all steps
        const steps = document.querySelectorAll('.survey-step');
        steps.forEach(step => step.style.display = 'none');

        // Show current step
        const currentStep = document.getElementById('step-' + stepIndex);
        if (currentStep) {
            currentStep.style.display = 'block';
        }
    }

    function nextStep(currentIndex) {
        // Simple validation (check if empty)
        const currentStep = document.getElementById('step-' + currentIndex);
        const inputs = currentStep.querySelectorAll('input, select');
        let valid = true;
        inputs.forEach(input => {
            if (input.required && !input.value) {
                valid = false;
                alert('Por favor responde esta pregunta.');
            }
        });

        if (valid) {
            showStep(currentIndex + 1);
        }
    }

    function prevStep(currentIndex) {
        showStep(currentIndex - 1);
    }
</script>
{% endblock %}